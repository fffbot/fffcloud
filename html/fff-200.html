
<!DOCTYPE html>
<html>
 <head>
    <title>Friday Facts #200 - Plans for 0.16 | Factorio</title>
    <link href="/static/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <link href="/static/img/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="/static/css/factorio.css" rel="stylesheet" type="text/css"/>
    <link href="/static/lightbox/css/lightbox.css" rel="stylesheet" type="text/css"/>
    <link href="/blog/rss" rel="alternate" title="Recent Blog Posts" type="application/atom+xml">
    <meta name="viewport" content="width=device-width">
    
    
 </head>
 <body style="background: rgb(22, 22, 22) url(/static/img/stressed_linen_texture.png) repeat 0 0;'">
  <div class="container header" style="margin-top: 30px;">

    <!-- top row -->
   <div class="row" style="margin-bottom: 30px;">
     <div class="span4">
       <a href="/"><img src="/static/img/factorio-logo.png" style="margin-top: 10px;"/></a>
     </div>
    <div class="span8 span8-navbar" style="margin-top: 10px;">
     <div class="user-controls">
      
           <a href="/login">log in</a>
           <a href="/signup">sign up</a>
      
     </div>

     

      

     <div class="navbar">
      <ul class="nav">
        
          
            <li >

            
              <a href=/
                 
              > Home </a>
            

            </li>
        
          
            <li >

            
              <a href=/store
                  style="color: #ff7200;" 
              > Merch </a>
            

            </li>
        
          
            <li  class="custom-dropdown" >

            

              <a class="custom-dropdown-toggle"
                data-toggle="dropdown"
                href="/game-overview"
                
                role="button">
                Game
              </a>

              <ul class="custom-dropdown-menu" role="menu">
                
                  <li role="presentation">
                    <a href=/starter-page>
                      Starter Page
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/screenshots>
                      Screenshots
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/videos>
                      Videos
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/content>
                      Content
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/modding>
                      Modding
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/team>
                      Team
                    </a>
                  </li>
                
              </ul>

            

            </li>
        
          
            <li  class="custom-dropdown" >

            

              <a class="custom-dropdown-toggle"
                data-toggle="dropdown"
                href="/support-overview"
                
                role="button">
                Support
              </a>

              <ul class="custom-dropdown-menu" role="menu">
                
                  <li role="presentation">
                    <a href=/help>
                      Help
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/faq>
                      FAQ
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/press-and-youtube>
                      Press and Youtube
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/community>
                      Community
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/partners>
                      Partners
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/credits>
                      Credits
                    </a>
                  </li>
                
              </ul>

            

            </li>
        
          
            <li >

            
              <a href=https://forums.factorio.com/
                 
              > Forums </a>
            

            </li>
        
          
            <li >

            
              <a href=/contact
                 
              > Contact </a>
            

            </li>
        

      </ul>
     </div>
     </div>
    </div>
   </div>
  <div class="container">
    <noscript>
      <div class="alert alert-block alert-error" style="font-weight: bold; ">
        Javascript is required for proper functioning of these web pages.
      </div>
    </noscript>

    
        
    

    
        
    

    

    

<div class="row">
  <div class="span12 blog-post">
    <h2 style="margin-top: 20px; margin-bottom:5px;">
      Friday Facts #200 - Plans for 0.16
    </h2>

    <div style="font-size: 11px;">Posted by kovarex &amp; TOGoS on 2017-07-21, <a href="/blog/">all posts</a></div>

    <p>
    <p style="text-align: center; margin:auto; margin-top:20px; margin-bottom: 20px;">
<img style="vertical-align: top;" src="https://cdn.factorio.com/assets/img/blog/fff-200-fireworks.gif">
</p>

Hello,<br/>
I can't believe that we have been able to produce a post every Friday for 200 weeks without missing a single one. To be honest I'm not sure if this isn't the right time to pause for a while, to avoid being this kind of show that gets worse and worse over time until it is so bad that you want to take your intestines and strangle yourself with them. But people in the office convinced me with arguments like "FFF is the only good thing we have", so we probably have to continue for a little longer.

<h4>0.16 plan<font size="2"> kovarex</font></h4>
Our 0.16 trello card list is long, probably too long, it contains 80 cards. Many of them have a similar history as this one:
<p style="text-align: center; margin:auto; margin-top:20px; margin-bottom: 20px;">
<img style="vertical-align: top;" src="https://cdn.factorio.com/assets/img/blog/fff-200-typical-trello-card.png">
</p>
The main reason of showing this is, that that it is almost certain, that some of these tasks will be pushed again to next version, or away completely. It depends how fast will the work on the more important things progress.<br/><br/>

The bigger things are:
<ul>
<li>Artillery train</li>
<li>GUI/UX improvements</li>
<li>Mod portal improvement (rewrite)</li>
<li>Map generation improvement (related to the updated high res terrains and decoratives)</li>
</ul>

Then there are optimisations, we want to tackle mainly these:
<ul>
<li>Train pathfinding and collision checking optimisations</li>
<li>Additional smoke related optimisations</li>
<li>Lamp related optimisations</li>
<li>Item stack optimisation</li>
<li>Optimisation of electric network update logic</li>
<li>Optimisation of logistic robot movement</li>
<li>Group multiple item icons to one sprite in order to optimize rendering of saturated belts</li>
</ul>

There are overall tweaks planned like:
<ul>
<li>Find a way to show connected walls + pipes in a blueprint</li>
<li>Confirm blueprint deletion</li>
<li>Fluid squashing in pipes</li>
<li>Map interaction improvements</li>
</ul>

And there are these semi-bugs or small things like:
<ul>
<li>Train block its own path with chain signals</li>
<li>Make programmable speaker 'Global playback' only apply for people on that force</li>
<li>Electric network UI weird with lots of accumulators.</li>
</ul>

Lets hope we can finish at least half of the stuff we plan for 0.16.

<h4>Map generation<font size="2"> TOGoS</font></h4>

<p>The current terrain generation tends to make a world that looks the same everywhere.
With the goal of making exploration more rewarding we've been working on a branch called "mapgen-fixes",
which introduces some new biomes, new decoratives, and changes to the way things are distributed.
I've been tasked with fixing up the obviously screwy parts
(next on the to-do list is to deal with an overabundance of biters)
so that this can finally get merged to master and others can start testing and giving their feedback.</p>

<p>On the one hand this kind of work is fun because you have a bit of artistic freedom.
There is no 'right answer' to what the Factorio world should look like,
so I can play with settings and try to create a result that I think is interesting.
On the other hand, not having a 'right answer' means you can't just write a unit test to tell if your job is done.
I needed a way to look at results from the map generator
and compare changes across versions
that would be more efficient and easier to automate than loading up the entire game
and poking around in the map editor, waiting for chunks to load,
and then trying to remember what it looked like before and asking myself
if this is better or worse.  So I created a map preview generator.</p>

<b>Map Preview Generator</b>

<p>In the interest of being able to compare against maps generated with the current versions of Factorio,
I got the map preview generator merged early.  In fact it's already available on 0.15;
you can use it from the command-line like so (adjust path to Factorio binary as needed):</p>

<blockquote><code>bin/x64/factorio --generate-map-preview=output-name.png --map-gen-seed=1230 --map-preview-scale=4</code></blockquote>

<p style="text-align: center; margin:auto; margin-top:20px; margin-bottom: 20px;">
<img style="vertical-align: top;" src="https://cdn.factorio.com/assets/img/blog/fff-200-map-preview-1.png">
</p>

<p>The above map is 900x900 pixels and has a resolution of 4 meters per pixel, so is 3.6km on a side.
To give some sense of scale, a medium-sized factory with mining outposts could easily extend to the edge,
but to cover the entire area would be rather impressive.</p>

<p>If you make a very zoomed-out map (scale=32 is the maximum supported for 0.15.x)
you may notice that it takes a long time to generate the preview.
On 0.16 this will have been taken care of by
refactoring the terrain generation system to operate at arbitrary scales
instead of always generating 32x32-tile chunks.
To understand why this works, you need to understand that map generation is done in 2 phases:</p>

<ul>
<li>Calculating the value of several variables (elevation, temperature, humidity, and a few others)
  for every point on the map.
  This is done by sampling a <a href="http://libnoise.sourceforge.net/glossary/#coherentnoise">coherent noise function</a>
  (whose basis is similar but not identical to Perlin noise).
  The value at each point can be calculated solely based on the point's coordinates and the map seed,
  making this part 'embarassingly parallelizable' and easy to do at any scale
  (and with a bit of further refactoring, by arbitrary transformations of the inputs).</li>
<li>One chunk at a time, 'correcting' the results of the first step,
  making sure entities don't overlap,
  replacing combinations of tiles that we don't have good transition graphics for, etc.
  This is where we enforce that the only thing that can be adjacent to water is grass,
  because that's the only transition we have graphics for
  (which happens to be something the art guys are working to rectify).</li>
</ul>

<p>For the sake of making the map preview generator fast and simple,
only the first step is done.
This is a good enough approximation for my purposes,
though if you look closely you may notice that shorelines are off by a tile or two in some places.</p>

<b>Programmable Noise</b>

<p>One of the things that I disliked about how Factorio's map generation works even before I was hired to improve it, was that
once you've expanded your base to a certain size,
exploration of the map ceases to be interesting.
At an extreme scale this uniformity is exceedingly obvious,
but it is also apparent at realistic factory scales.
There are no especially large lakes to work your way around,
and different parts of the map don't really have any unique character.</p>

<p>Take for instance this super zoomed-out map (32 tiles per pixel):</p>

<p style="text-align: center; margin:auto; margin-top:20px; margin-bottom: 20px;">
<img style="vertical-align: top;" src="https://cdn.factorio.com/assets/img/blog/fff-200-map-preview-2.png">
</p>

<p>In part, this is due to the underlying noise functions we use not being very flexible.
The function to calculate elevation, for example,
is defined by a very small number of variables, including seed,
number of <a href="http://libnoise.sourceforge.net/glossary/#octave">octaves</a>,
and <a href="http://libnoise.sourceforge.net/glossary/#persistence">persistence</a>.
Persistence itself is varied over the map so that in some areas you get smooth coastlines and in others very noisy ones.
This simple specification does a pretty good job of generating random-looking worlds,
but it doesn't give as much control as I would like in order to make different parts of the world look different.</p>

<p>In order to efficiently calculate terrain,
a lot of the low-level code is dedicated to caching noise values
and vectorizing calculations on them.
This is great, but means the high-level logic for how noise is generated
is rather buried in a lot of implementation details,
and is therefore difficult to reason about and even harder to change.
But abstractly, the noise function is just a functional program that adds and multiplies values from the basis function (at different scales) together.
In order to make this logic more obvious I've created an assembly-like language for specifying the steps to produce noise.
e.g. Take basis noise at a certain scale, divide it by persistence, add in basis noise at another scale, and so on.
This approach is super flexible, but the assembly language is not very nice to read or write.
A longer-term solution will be to allow building noise functions from Lua code,
which will have the side-effect of making the system hackable by modders.</p>

<p>Abstracting high-level aspects of terrain generation out of the C++ code opens up a lot of possibilities.
Some ideas:</p>

<ul>
<li>Larger scale features that are modulated by distance so that
  the starting area remains relatively flat and predictable,
  but you find seas and larger continents far away.</li>
<li>'Ridge' some large-scale noise to produce linear features like mountain ranges or rivers.</li>
<li>Altering the input to some noise layers with the output of another noise function.
  This can warp landforms in a way that <a href="https://cdn.factorio.com/assets/img/blog/fff-200-map-land.png">looks a bit like the result of plate tectonics</a>.</li>
</ul>

<p>Related to this, we are also working to make the world seem a bit less flat, but that is probably better left for another FFF.</p>

<p>As always, leave us any feedback or comments over on our <a href="https://forums.factorio.com/51131">forum</a></p>
    </p>



    <div class="footer">

      <div class="footer-copyright">
          Copyright © 2015 - 2018 Wube Software - all rights reserved.
        </div>
        <div class="footer-menu">

          

          <a href="/terms-of-service" style="font-size: 11px;"> Terms of Service </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/privacy-policy" style="font-size: 11px;"> Privacy </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/imprint" style="font-size: 11px;"> Imprint </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/presskit" style="font-size: 11px;"> Presskit </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/faq" style="font-size: 11px;"> FAQ </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/blog/rss" style="font-size: 11px;"> RSS </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/jobs" style="font-size: 11px;">
            Jobs
          </a>
      </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  
  <script src="/static/js/raphael-min.js" type="text/javascript"></script>
  <script src="/static/js/factorio.min.js" type="text/javascript"></script>
  <script src="/static/lightbox/js/lightbox.min.js" type="text/javascript"></script>
  <script type="text/javascript">
   var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-115167276-1']);
        _gaq.push(['_trackPageview']);
        (function()
        {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
  </script>
 </body>
</html>