
<!DOCTYPE html>
<html>
 <head>
    <title>Friday Facts #47 - CRC fun | Factorio</title>
    <link href="/static/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <link href="/static/img/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="/static/css/factorio.css" rel="stylesheet" type="text/css"/>
    <link href="/static/lightbox/css/lightbox.css" rel="stylesheet" type="text/css"/>
    <link href="/blog/rss" rel="alternate" title="Recent Blog Posts" type="application/atom+xml">
    <meta name="viewport" content="width=device-width">
    
    
 </head>
 <body style="background: rgb(22, 22, 22) url(/static/img/stressed_linen_texture.png) repeat 0 0;'">
  <div class="container header" style="margin-top: 30px;">

    <!-- top row -->
   <div class="row" style="margin-bottom: 30px;">
     <div class="span4">
       <a href="/"><img src="/static/img/factorio-logo.png" style="margin-top: 10px;"/></a>
     </div>
    <div class="span8 span8-navbar" style="margin-top: 10px;">
     <div class="user-controls">
      
           <a href="/login">log in</a>
           <a href="/signup">sign up</a>
      
     </div>

     

      

     <div class="navbar">
      <ul class="nav">
        
          
            <li >

            
              <a href=/
                 
              > Home </a>
            

            </li>
        
          
            <li >

            
              <a href=/store
                  style="color: #ff7200;" 
              > Merch </a>
            

            </li>
        
          
            <li  class="custom-dropdown" >

            

              <a class="custom-dropdown-toggle"
                data-toggle="dropdown"
                href="/game-overview"
                
                role="button">
                Game
              </a>

              <ul class="custom-dropdown-menu" role="menu">
                
                  <li role="presentation">
                    <a href=/starter-page>
                      Starter Page
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/screenshots>
                      Screenshots
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/videos>
                      Videos
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/content>
                      Content
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/modding>
                      Modding
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/team>
                      Team
                    </a>
                  </li>
                
              </ul>

            

            </li>
        
          
            <li  class="custom-dropdown" >

            

              <a class="custom-dropdown-toggle"
                data-toggle="dropdown"
                href="/support-overview"
                
                role="button">
                Support
              </a>

              <ul class="custom-dropdown-menu" role="menu">
                
                  <li role="presentation">
                    <a href=/help>
                      Help
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/faq>
                      FAQ
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/press-and-youtube>
                      Press and Youtube
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/community>
                      Community
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/partners>
                      Partners
                    </a>
                  </li>
                
                  <li role="presentation">
                    <a href=/credits>
                      Credits
                    </a>
                  </li>
                
              </ul>

            

            </li>
        
          
            <li >

            
              <a href=https://forums.factorio.com/
                 
              > Forums </a>
            

            </li>
        
          
            <li >

            
              <a href=/contact
                 
              > Contact </a>
            

            </li>
        

      </ul>
     </div>
     </div>
    </div>
   </div>
  <div class="container">
    <noscript>
      <div class="alert alert-block alert-error" style="font-weight: bold; ">
        Javascript is required for proper functioning of these web pages.
      </div>
    </noscript>

    
        
    

    
        
    

    

    

<div class="row">
  <div class="span12 blog-post">
    <h2 style="margin-top: 20px; margin-bottom:5px;">
      Friday Facts #47 - CRC fun
    </h2>

    <div style="font-size: 11px;">Posted by Tomas on 2014-08-15, <a href="/blog/">all posts</a></div>

    <p>
    <p>Hello FFF readers,</p>

<p>
another week, another set of news. Kovarex took some more vacation days for a visit to Slovakia where his relatives live. He will come back on Sunday just in time to switch places with me. I will be off for the whole next week, playing Go, hiking and relaxing in the Czech <a href="http://en.wikipedia.org/wiki/Beskids">Beskydy</a> mountains. Another fun fact is that the most active forum user ssilk took some vacation as well and he actually came to Prague. I will go meet with him tomorrow.
</p>

<h4> 0.10.7 </h4>
<p>
 We had to kind of abandon our "new major feature release every month or two" plan simply because there is too much work to do to stabilize the current feature release. One of the reasons for this is that thanks to the videos by famous youtubers there are now way more Factorio players than let's say a year ago. More players means more gameplay situations and combinations "tested" and that means more bugs found. Even with quite some effort we have been struggling to keep the amount of reported bugs at our forums around 50. The "remaining" bugs are often system specific crashes, edge cases related to our graphics library (allegro) or problems in some complicated game mechanics (especially logistic / contruction network and rail network).
</p>

<p>
Anyway we have been patiently grinding through the bug list and the result is <a href="https://forums.factorio.com/forum/viewtopic.php?f=3&t=5381">0.10.7</a> which has been released today. It should be one step closer to the stable release for 0.10.x.
</p>

<h4> Multiplayer progress </h4>
<p>
In the meantime, the multiplayer branch saw progress namely in topics mentioned in the past Friday Facts. We have fixed the crashes coming from running the multiplayer updates in the separate thread from the render. This also allowed us to improve the game loop to skip unfinished renders (or flips) and continue with the next update instead. I have also spent quite some time looking into determinism issues because this was related to work on 0.10.7 as well (there were couple of bugs reporting that research desyncs the replay).
</p>

<p>
Currently the fiddling with determinism looks as follows. The game runs in a special mode when it makes a <a href="http://en.wikipedia.org/wiki/Cyclic_redundancy_check">CRC</a> from the whole map every tick. On top of that it actually saves the map with some useful human readable tags to a new file every tick as well. These two operations make the game crawl to at most units of FPS, by the way. A lot of patience is required :) After a while we save the game and replay it. The replay also takes the CRC check every tick. In case this CRC doesn't correspond to the CRC generated during the game run, the desynchronization exception is thrown. Moreover the replay saves the game in the same save format (with humban readable tags) as the running game did.
</p>

<p>
So now we have two save files with readable tags from the same map tick that we can compare. One is from the replay and the other one from the running game. We also know that this is the first tick of desynchronization (we make the check every tick). Now comes the binary diffing detective work. The ocasional readable tags help us figure out where exactly the saves differ. Since this is the first desynchronization tick the difference is usually very small - typically just a value of one variable. The last step is to sit down, think and figure out how could such a desynchronization happen. Once it is clear what went wrong, fixing the problem is often the easies part.
</p>

<p>
We have used this mechanism to fix the determinism bugs so far and it works quite well for reproducible scenarios in our local environment. We haven't yet quite figured out how we will handle multiplayer desync problems reported by users. That will be the tough task :D
</p>

<h4> Rail endings </h4>
<p>
While working on bugfixes in the 0.10.x branch we keep developing new stuff in the master as well. For instance a neat little thing we call "rail endings" has just been finished. From the gameplay perspective it is a purely visual addition that renders a special sprite at the end of every rail. The train doesn't have a collision with the rail ending (it rides over it). This mechanism has two purposes:

<ul>
<li> The <strong> aesthetic feeling </strong> is better. There are no more sharp "cut-like feeling" ends for railroads. </li>
<li> There is now <strong> visual feedback </strong> for wrong rail setups. Especially when straight and curved rails interact, it happened now and then that there was an extra straight rail which didn't have any sense. This was causing confusion to the players and we even had bug reports posted based on these setups (for instance when riding train manually stopped in the middle of the curve for no reason - when in fact it reached the end of the wrongly placed straight rail). </li>
</ul>

<p>
Pavel made the sprites for the rail endings and Kuba did the programming integration. You can see an ingame preview below.
</p>

<h4>GFX greetings from Mallorca</h4>
<p>
We got an email from Albert saying he is alive and well. He has survived the sailing race and he is now enjoying his time off to relax and gather energy. He will definitely need it because in September he is coming back to Prague to raise the game visuals bar even higher and work on the new content we have had in mind for a while.
</p>

<p>
   <img src="https://cdn.factorio.com/assets/img/blog/fff-47-rail-endings.jpg"/>
</p>

<p>
The thread for your comments is ready as usual <a href="https://forums.factorio.com/forum/viewtopic.php?f=38&t=5382">at our forums</a>.
</p>
 
    </p>



    <div class="footer">

      <div class="footer-copyright">
          Copyright Â© 2015 - 2018 Wube Software - all rights reserved.
        </div>
        <div class="footer-menu">

          

          <a href="/terms-of-service" style="font-size: 11px;"> Terms of Service </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/privacy-policy" style="font-size: 11px;"> Privacy </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/imprint" style="font-size: 11px;"> Imprint </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/presskit" style="font-size: 11px;"> Presskit </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/faq" style="font-size: 11px;"> FAQ </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/blog/rss" style="font-size: 11px;"> RSS </a>
          <span style="font-size: 11px;"> | </span>
          

          <a href="/jobs" style="font-size: 11px;">
            Jobs
          </a>
      </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  
  <script src="/static/js/raphael-min.js" type="text/javascript"></script>
  <script src="/static/js/factorio.min.js" type="text/javascript"></script>
  <script src="/static/lightbox/js/lightbox.min.js" type="text/javascript"></script>
  <script type="text/javascript">
   var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-115167276-1']);
        _gaq.push(['_trackPageview']);
        (function()
        {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
  </script>
 </body>
</html>